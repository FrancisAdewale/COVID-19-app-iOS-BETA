#!/usr/bin/env bash

set -euo pipefail

DATA=$(cat <<EOF
{
  "event_type":"docker-ci-test",
	"client_payload": {
		"ref": "$(git log --pretty='%H' HEAD~1..HEAD)"
	}
}
EOF
)

echo 'creating dispatch event'
echo $DATA

curl \
	--verbose \
	--url 'https://api.github.com/repos/nhsx/sonar-ios/dispatches' \
	--header "Content-type: application/json" \
	--header "Authorization: token $GITHUB_USER_TOKEN" \
	--data "$DATA"
